canvas=document.getElementById("mycanvas");context=canvas.getContext("2d");canvas.width=window.innerWidth;canvas.height=window.innerHeight;context.fillStyle="white";context.fillRect(0,0,canvas.width,canvas.height);attribute={width:7,pencilWidth:10,eraseWidth:30,color:"#0f0f0f",style:calligraphy,active:"pencil"};pages={};var prev_color="";var dragging=false;var startLocation;function calligraphy(position){context.strokeStyle=attribute.color;context.lineJoin=context.lineCap="round";context.lineWidth=attribute.width;context.beginPath();context.moveTo(startLocation.x,startLocation.y);context.lineTo(position.x,position.y);context.closePath();context.stroke();startLocation=position}function pen(position){context.strokeStyle=attribute.color;context.lineJoin=context.lineCap="round";context.fillStyle=attribute.color;context.lineWidth=attribute.width;context.lineTo(position.x,position.y);context.stroke();context.beginPath();context.arc(position.x,position.y,attribute.width/2,0,Math.PI*2);context.fill();context.beginPath();context.moveTo(position.x,position.y)}function getpositionmouse(event){var x=event.clientX-canvas.getBoundingClientRect().left;var y=event.clientY-canvas.getBoundingClientRect().top;console.log(x+" : "+y);return{x:x,y:y}}function getpositiontouch(event){if(event.touches){if(event.touches.length==1){var touch=event.touches[0];touchX=touch.pageX-touch.target.offsetLeft;touchY=touch.pageY-touch.target.offsetTop}}return{x:touchX,y:touchY}}function dragStartMouse(event){dragging=true;startLocation=getpositionmouse(event);attribute.style(startLocation)}function dragMouse(event){var position;if(dragging===true){position=getpositionmouse(event);attribute.style(position)}}function dragStopMouse(event){dragging=false;context.beginPath()}function dragStartTouch(event){dragging=true;startLocation=getpositiontouch(event);attribute.style(position)}function dragTouch(event){var position;if(dragging===true){position=getpositiontouch(event);attribute.style(position)}}function dragStopTouch(event){dragging=false;context.beginPath()}function init(){canvas.addEventListener("touchstart",dragStartTouch);canvas.addEventListener("touchend",dragStopTouch);canvas.addEventListener("touchmove",dragTouch);canvas.addEventListener("mousedown",dragStartMouse);canvas.addEventListener("mouseup",dragStopMouse);canvas.addEventListener("mousemove",dragMouse);setSlider(attribute.width)}window.addEventListener("load",init);window.addEventListener("resize",function(){var image=context.getImageData(0,0,canvas.width,canvas.height);canvas.width=window.innerWidth;canvas.height=window.innerHeight;context.fillStyle="white";context.fillRect(0,0,canvas.width,canvas.height);context.putImageData(image,0,0)});function clearScreen(){context.fillStyle="white";context.fillRect(0,0,canvas.width,canvas.height);if(canvas.height>window.innerHeight){canvas.height=window.innerHeight}}function eraser(elem){attribute["active"]="eraser";removeActive();elem.classList.add("is-active");sliderMaxMin(10,50);attribute.width=attribute.eraseWidth;setSlider(attribute.eraseWidth);if(attribute.color!=="#ffffff")prev_color=attribute.color;attribute.color="#ffffff"}function pencil(elem){attribute["active"]="pencil";removeActive();elem.classList.add("is-active");sliderMaxMin(1,30);attribute.width=attribute.pencilWidth;setSlider(attribute.width);attribute.color=prev_color;attribute.color=pick()}function colorfill(){context.fillStyle=attribute.color;context.fillRect(0,0,canvas.width,canvas.height)}function save(){savepage();var pdf=new jsPDF({orientation:"landscape",unit:"mm",format:"a3"});var key1=0;for(key in pages){var dataURL=pages[key];pdf.addImage(dataURL,"JPEG",0,30);pdf.addPage()}pdf.save("webboard.pdf")}function setSlider(val){var slider=document.querySelector(".slider");slider.value=val}function getSlider(){var slider=document.querySelector(".slider");return slider.value}function sliderMaxMin(min,max){var slider=document.querySelector(".slider");slider.max=max;slider.min=min}function changeObjSize(){if(attribute["active"]==="pencil"){attribute.width=getSlider();attribute.pencilWidth=getSlider()}if(attribute["active"]=="eraser"){attribute.eraseWidth=getSlider();attribute.width=getSlider()}}function removeActive(){var active=Array.prototype.slice.call(document.querySelectorAll(".is-active"));active.forEach(function(element){if(element.classList.contains("is-active")){element.classList.remove("is-active")}})}function getPageNo(){var classname=canvas.className;var pageno=classname.substr(6);return pageno}function dataToCanvas(url){var img=new Image;img.src=url;img.onload=function(){context.drawImage(img,0,0)}}function savepage(){var page=getPageNo();pages[page]=canvas.toDataURL()}function nextPage(){var pageno=getPageNo();var total=Object.keys(pages).length;var next=(Number(pageno)+1).toString();savepage();canvas.className="canvas"+next;if(next in pages){context.fillStyle="white";context.fillRect(0,0,canvas.width,canvas.height);dataToCanvas(pages[next]);setPageNo(next,total)}else{context.fillStyle="white";context.fillRect(0,0,canvas.width,canvas.height);setPageNo(next,next)}}function prevPage(){var pageno=getPageNo();var total=Object.keys(pages).length;var prev=(Number(pageno)-1).toString();if(prev>0){savepage();canvas.className="canvas"+prev;context.fillStyle="white";context.fillRect(0,0,canvas.width,canvas.height);dataToCanvas(pages[prev]);setPageNo(prev,total)}}function changePensize(a){attribute.width=a}var modal=document.getElementById("myModal");var btn=document.getElementById("myBtn");var span=document.getElementsByClassName("close")[0];btn.onclick=function(){modal.style.display="block"};span.onclick=function(){modal.style.display="None"};window.onclick=function(event){if(event.target==modal){modal.style.display="none"}};function changecolor(a){attribute["active"]="pencil";attribute.color=a;modal.style.display="none"}function setPageNo(page,total){savepage();var x=document.getElementsByClassName("page")[0];x.innerHTML="Page "+(page.toString()+" of "+total.toString())}function extendPage(){var image=context.getImageData(0,0,canvas.width,canvas.height);canvas.width=canvas.width;canvas.height=canvas.height+window.innerHeight;context.fillStyle="white";context.fillRect(0,0,canvas.width,canvas.height);context.putImageData(image,0,0)}function activateModal(){document.querySelector(".modal").classList.add("is-active")}function closeModal(){document.querySelector(".modal").classList.remove("is-active")}